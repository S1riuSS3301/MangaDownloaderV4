# MangaToolkitV4

Инструментарий для аудита и скачивания манги с mangapoisk.io, а также сборки томовых PDF-«лент» из скачанных изображений.

## Возможности

- __Скачивание по URL конкретной главы__ (`--chapter-url`).
- __Полная закачка всех глав тайтла по slug__ (`--slug`).
- __Автонавигация по «следующей» главе__ и числовой fallback для пропусков.
- __Аудит онлайн-списка глав__ по slug: количество, диапазоны, разбиение по томам.
- __Аудит локальных загрузок__ и сравнение с онлайн-списком (по локальному HTML/онлайн).
- __Сборка PDF-«лент» по томам__ из скачанных изображений.
- Логи и настраиваемые заголовки/куки через `config/config.yaml`.

## Требования

- Python 3.10+
- Linux/macOS/WSL (Windows — через WSL рекомендуется)
- Зависимости из `requirements.txt`

## Установка

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

## Конфигурация

Скопируйте пример и отредактируйте под себя:

```bash
cp config/config.example.yaml config/config.yaml
```

Файл `config/config.yaml`:
- `app.downloads_dir` — каталог для загрузок (по умолчанию `Downloads/` внутри проекта)
- `app.concurrency` — параллелизм скачивания
- `network.headers` — HTTP-заголовки (User-Agent, Referer)
- `network.cookie_file` — путь к cookie-файлу (JSON-формат, как экспорт браузерных cookies). Можно оставить пустым, если не нужно
- `logging.dir` — каталог логов (по умолчанию `logs/`)

Пример в `config/config.example.yaml` не содержит персональных путей и может быть закоммичен.

## Быстрый старт

- __Скачать все главы по slug__:

```bash
python3 cli.py --slug wedding-ring-story-1
```

- __Скачать одну главу по полной ссылке__:

```bash
python3 cli.py --chapter-url "https://mangapoisk.io/manga/<slug>/chapter/15-1"
```

- __Dry-run (без скачивания, отладка)__:

```bash
python3 cli.py --slug <slug> --dry-run
```

- __Аудит списка глав онлайн__ (по slug):

```bash
python3 tools/audit_chapters.py --slug <slug>
```

- __Сборка PDF-«лент» по томам__ из уже скачанных изображений:

```bash
python3 tools/ribbon_pdf.py --slug <slug> [-f]
```

PDF сохраняются в каждом каталоге тома как `volume.pdf`.

## Структура проекта

```
MangaToolkitV4/
├─ cli.py                  # основной CLI: скачивание глав/тайтлов
├─ extractor.py            # извлечение ссылок на изображения из HTML
├─ downloader.py           # скачивание изображений с параллелизмом
├─ session_manager.py      # HTTP-сессия, повторы/таймауты, куки
├─ logging_setup.py        # настройка логирования
├─ tools/
│  ├─ audit_chapters.py    # аудит онлайна по slug
│  ├─ audit_local_from_file.py # аудит по локальному HTML
│  ├─ audit_local_compare.py   # сравнение онлайн vs локальные загрузки
│  └─ ribbon_pdf.py        # сборка томовых PDF-«лент»
├─ config/
│  ├─ config.yaml          # ваш рабочий конфиг (в .gitignore)
│  └─ config.example.yaml  # пример для репозитория
├─ requirements.txt
├─ Downloads/              # Загрузки (в .gitignore)
├─ logs/                   # Логи (в .gitignore)
└─ archives/               # Архивы (опционально, в .gitignore)
```

## Примеры использования

- __Скачать все главы тайтла__ и затем __собрать PDF__:

```bash
python3 cli.py --slug <slug>
python3 tools/ribbon_pdf.py --slug <slug>
```

- __Скачать одну главу__ и __N следующих__:

```bash
python3 cli.py --chapter-url "https://mangapoisk.io/manga/<slug>/chapter/12-3" --auto-next 5
```

- __Скачать все главы, начиная от первой__ (режим `--all`):

```bash
python3 cli.py --chapter-url "https://mangapoisk.io/manga/<slug>/chapter/1-1" --all
```

## Заметки по реализации

- Имена каталогов соответствуют метаданным из страницы: `Downloads/<slug>/Том NN/Глава <id>`.
- Десятичные подглавы (например, `15-86`, `72.1`) корректно упорядочиваются и именуются.
- Навигация «следующая глава» ищется в `<link rel="next">`, кнопках/якорях и по эвристикам; есть числовой fallback.
- В `tools/audit_chapters.py` и в `cli.py` парсинг глав обеспечивает охват всех ссылок `/chapter/A-B(.C...)`.

## Рекомендации по эксплуатации

- На некоторых тайтлах сервер требует корректных cookies. Экспортируйте cookies браузера в JSON и укажите `network.cookie_file`.
- При блокировках используйте правдоподобный User-Agent и Referer (см. `config.yaml`).
- Для долгих операций удобно запускать в tmux/screen. Логи пишутся в `logs/`.

## Безопасность и ответственность

Инструмент предназначен для личного использования и архивации. Уважайте лицензионные соглашения и законы вашей юрисдикции. Автор не несёт ответственности за возможные последствия использования.

## Лицензия

Проект распространяется по пользовательскому соглашению (EULA): см. файл `LICENSE`.

- Владалец прав: S1riuSS3301 (c) 2025.
- Разрешено использовать ПО «как есть» в неизменённом виде для личных/внутренних целей.
- Запрещены: форки, модификации, производные работы, публичная выкладка изменённых версий, перераспространение и коммерческое использование, суб-лицензирование.

Подробные условия и ограничения приведены в `LICENSE`.


https://t.me/s1riu_ssss
